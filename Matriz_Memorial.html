<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Matriz de Memoria</title>
    <style>
        canvas {
            /* Centraliza o canvas na tela do browser */
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin: auto;
        }
    </style>
</head>

<body>
    <script type="text/javascript">

        // Variáveis Globais.
        var canvas,   // Tela em que é apresentado o jogo.
            ctx,      // Pincel que desenha os elementos do jogo.
            ALTURA,   // Altura da tela do browser.
            LARGURA,  // Largura da tela do browser.
            global_level = 5,    // Nível de dificuldade do jogo.

            // Objeto que serve de limite até onde a matriz pode crescer.
            limiteMatriz = {
                x: 0,      // Posição no eixo X.
                y: 0,      // Posição no eixo Y.
                altura: 0,
                largura: 0,

                desenha: function () {
                    this.x = LARGURA / 20;
                    this.y = ALTURA / 7;
                    this.altura = 480;
                    this.largura = 720
                    ctx.strokeRect(this.x, this.y, this.largura, this.altura);
                }
            },

            // Objeto Matriz onde são apresentados os quadrados clicáveis.
            matriz = {
                x: 0,      // Posição no eixo X.
                y: 0,      // Posição no eixo Y.
                altura: 0,
                largura: 0,
                cor: "#fff",
                qtdQuadradinhosEmLinha: 0,  // Quantidade de quadrados desenhados em uma linha.
                arrQuadradinhos: [],        // Array de quadrados (elementos) da matriz.
                i: 3,   // Número de Linhas da Matriz.
                j: 3,   // Número de Colunas da Matriz.
                nivel: 0, // Nível de complexidade da matriz

                // Método que desenha a matriz no Canvas.
                desenha: function () {
                    var ajuste = 50; // Ajuste que permite a matriz ficar quadrada (1:1) e centralizada no Canvas.

                    this.altura = (limiteMatriz.altura / 2) + ajuste;
                    this.largura = (limiteMatriz.largura / 2) - ajuste;
                    this.x = ((limiteMatriz.x + this.largura) / 2) + ajuste + 18;
                    this.y = ((limiteMatriz.y + this.altura) / 2) - 7;
                    ctx.fillStyle = this.cor;
                    ctx.fillRect(this.x, this.y, this.largura, this.altura);
                },

                // Método que insere quadradinhos (elementos) na matriz.
                insere: function () {

                    let espacamento = 55; // Espaçamento em pixels entre os quadrados que são desenhados.

                    if (!(this.arrQuadradinhos.length)) { // Se a matriz estiver vazia, adiciona o primeiro elemento.
                        var quad = new quadradinho(this.x, this.y, (this.altura / 4) - 15, (this.largura / 4) - 15);
                        this.arrQuadradinhos.push(quad);
                        this.qtdQuadradinhosEmLinha++;
                    }

                    else { // Senão, adiciona os próximos elementos.
                        /*  Verifica se a quantidade de quadrados desenhados em linha é diferente
                        *   da raiz quadrada do limite total de elementos da matriz (linhas x colunas). */
                        if (this.qtdQuadradinhosEmLinha !== Math.floor(Math.sqrt(this.i * this.j))) {
                            /*  Adiciona um novo quadradinho à matriz, usando com base os dados do último quadradinho da matriz
                            *   para posicioná-lo corretamente na grade. */
                            var quad = new quadradinho(this.arrQuadradinhos[this.arrQuadradinhos.length - 1].getX() + (espacamento + 8), this.arrQuadradinhos[this.arrQuadradinhos.length - 1].getY(), (this.altura / 4) - 15, (this.largura / 4) - 15);
                            quad.setCor("#b" + Math.floor(Math.random() * 100 + 1).toString());
                            this.arrQuadradinhos.push(quad);
                            this.qtdQuadradinhosEmLinha++;
                        }

                        /*  Se a quantidade de quadrados é igual à raiz quadrada do limite de elementos,
                        *   ocorre uma quebra de linha e o novo quadradinho é posicionado no início do eixo X. */
                        else {
                            var quad = new quadradinho(this.x, this.arrQuadradinhos[this.arrQuadradinhos.length - 1].getY() + (espacamento + 3), (this.altura / 4) - 15, (this.largura / 4) - 15);
                            this.arrQuadradinhos.push(quad);
                            this.qtdQuadradinhosEmLinha = 1;
                        }
                    }

                    this.arrQuadradinhos[this.arrQuadradinhos.length - 1].desenha(); // Desenha o quadradinho na matriz do Canvas
                },

                // Método que eleva um nível na matriz
                proximoNivel: function () {
                    if (this.i === this.j) {
                        this.i++;
                    }
                    else {
                        this.j = this.i;
                    }
                    this.nivel++;
                }
            }
        
        // Classe de Quadradinhos que servem de elementos para a matriz.
        function quadradinho(x, y, altura, largura) {
            var _x = x,
                _y = y,
                _altura = altura,
                _largura = largura;
            _cor = "#423433";

            this.setCor = function (cor) {
                _cor = cor;
            }

            this.getX = function () {
                return _x;
            }

            this.getY = function () {
                return _y;
            }

            this.getAltura = function () {
                return _altura
            }

            this.getLargura = function () {
                return _largura
            }

            this.desenha = function () { // Método que desenha o quadradinho no Canvas.
                ctx.fillStyle = _cor;
                ctx.fillRect(_x, _y, _largura, _altura);
            }
        }

        /*quadradinho = {
            x: 0,
            y: 0,
            altura: 0,
            largura: 0,
            cor: "#423433",

            desenha: function () {
                this.x = matriz.largura + 100;
                this.y = matriz.altura + 50;
                this.altura = matriz.altura / 4
                this.largura = matriz.largura / 4
                ctx.fillStyle = this.cor;
                ctx.fillRect(this.x, this.y, this.largura, this.altura);
            }
        };*/

        // Função Principal.
        function main() {
            ALTURA = window.innerHeight; // Captura a altura da tela do browser
            LARGURA = window.innerWidth; // Captura a largura da tela do browser

            if (LARGURA > 500) {
                LARGURA = 800;
                ALTURA = 600;
            }

            canvas = document.createElement("canvas"); // Cria um elemento de tag 'canvas' em HTML
            canvas.height = ALTURA;
            canvas.width = LARGURA;
            canvas.style.border = "1px solid #000";

            ctx = canvas.getContext("2d"); // Tudo o que é desenhado no Canvas, por meio de 'ctx', é um elemento 2D
            document.body.appendChild(canvas); // Adiciona o elemento ao corpo HTML

            rodarJogo();

        }

        // Rotinas para execução do Jogo.
        function rodarJogo() {
            desenha();
        }

        // Função que pausa a execução do programa por alguns milissegundos.
        function sleep(milliseconds) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
                if ((new Date().getTime() - start) > milliseconds)
                    break;
            }
        }

        // TODO
        function desenha() {
            fundo_canvas = "img/brown_texture.jpg"
            canvas.style.backgroundImage = "url(" + fundo_canvas + ")";

            limiteMatriz.desenha();
            matriz.desenha();

            // TODO
            for (let i = 0; i < global_level; i++) {
                matriz.proximoNivel();
            }
            
            for (let i = 0; i < 25; i++) {
                matriz.insere();                
            }


            //matriz.arrQuadradinhos[0].desenha();
            ctx.moveTo(limiteMatriz.x + 360, limiteMatriz.y);
            ctx.lineTo(limiteMatriz.x + 360, limiteMatriz.y + 480);
            ctx.stroke();
            ctx.moveTo(limiteMatriz.x, limiteMatriz.y + 240);
            ctx.lineTo(limiteMatriz.x + 720, limiteMatriz.y + 240);
            ctx.stroke();

            console.log("Elementos: " + matriz.arrQuadradinhos.length);
        }

        main();
    </script>

</body>

</html>